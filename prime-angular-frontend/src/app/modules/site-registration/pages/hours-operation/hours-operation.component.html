<app-page [busy]="busy">
  <app-page-header>PharmaNet Site Registration</app-page-header>
  <app-site-progress-indicator [inProgress]="!isCompleted"></app-site-progress-indicator>

  <form (ngSubmit)="onSubmit()"
        [formGroup]="form"
        novalidate>

    <section class="mb-3">

      <app-page-subheader2>
        <ng-container appPageSubheader2Title>{{ title }}</ng-container>
        <ng-container appPageSubheader2Summary>
          Specify the days and times your location is open.
        </ng-container>
      </app-page-subheader2>

      <app-alert *ngIf="hasNoBusinessHoursError"
                 type="danger"
                 icon="warning">
        <ng-container #alertContent
                      class="alert-content">
          No hours of operation have been chosen.
        </ng-container>
      </app-alert>

      <ng-container formArrayName="businessDays"
                    *ngFor="let businessDay of businessDays.controls; let i = index;">
        <div class="row">
          <span class="col-md-2 col-4 mt-3">{{ WeekDay[i] }}</span>
          <mat-slide-toggle class="col-md-2 col-4 mt-3"
                            color="primary"
                            (change)="onDayToggle(businessDay, $event)"
                            [checked]="hasDay(businessDay)">
            {{ (hasDay(businessDay)) ? "Open" : "Closed" }}
          </mat-slide-toggle>
          <ng-container [formGroup]="businessDay">
            <mat-form-field class="col-md-3 col-12"
                            [class.hide]="!hasDay(businessDay)">
              <mat-label>Opens at</mat-label>
              <input matInput
                     mask="AB:CB"
                     [patterns]="busyHoursTimePattern"
                     formControlName="startTime"
                     placeholder="00:00"
                     [errorStateMatcher]="busDayHoursErrStateMatcher">
              <mat-error *ngIf="businessDay.hasError('lessthan') || businessDay.get('startTime').hasError('length')">
                Invalid
                <!-- TODO need better error message, but width makes messaging hard due to wrapping -->
                <!-- Opening hours must be earlier than closing hours -->
              </mat-error>
              <mat-error *ngIf="businessDay.get('startTime').hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
            <mat-form-field class="col-md-3 col-12"
                            [class.hide]="!hasDay(businessDay)">
              <mat-label>Closes at</mat-label>
              <input matInput
                     mask="AB:CB"
                     [patterns]="busyHoursTimePattern"
                     formControlName="endTime"
                     placeholder="00:00"
                     [errorStateMatcher]="busDayHoursErrStateMatcher">
              <mat-error *ngIf="businessDay.hasError('lessthan') || businessDay.get('endTime').hasError('length')">
                Invalid
                <!-- TODO need better error message, but width makes messaging hard due to wrapping -->
                <!-- Opening hours must be earlier than closing hours -->
              </mat-error>
              <mat-error *ngIf="businessDay.get('endTime').hasError('required')">
                Required
              </mat-error>
            </mat-form-field>
          </ng-container>
        </div>
      </ng-container>

    </section>

  </form>

  <app-page-footer [isInitialEnrolment]="!isCompleted"
                   [hasSecondaryAction]="true"
                   primaryActionLabel="Save and Continue"
                   (save)="onSubmit()"
                   (back)="onBack()"></app-page-footer>

</app-page>
