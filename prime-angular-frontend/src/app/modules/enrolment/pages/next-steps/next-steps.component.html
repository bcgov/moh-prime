<div class="app-print-layout">

  <app-enrollee-page [busy]="busy">

    <app-page-header>
      {{ title }}
    </app-page-header>

    <app-enrolment-progress-indicator *ngIf="initialEnrolment"
                                      [inProgress]="initialEnrolment"></app-enrolment-progress-indicator>

    <div class="row">
      <ng-container *ngIf="initialEnrolment; else renewalConfirmation">
        <div *ngIf="!complete"
             imageName="notification"
             class="col-12">
          <app-page-subheader [divider]="false">
            <ng-container appPageSubheaderTitle>Share your approval with your PharmaNet administrator</ng-container>
            <ng-container appPageSubheaderSummary>
              PRIME will send your enrolment information to your PharmaNet administrator(s) so they can set up your
              access.
              <div class="font-italic"
                   *ngIf="enrolment.currentStatus.statusCode === EnrolmentStatus.EDITABLE">
                Note: You cannot access PharmaNet without completing this step. If necessary, you can leave this blank
                and
                return to PRIME later to enter the email(s).
              </div>
            </ng-container>
          </app-page-subheader>
        </div>
      </ng-container>

      <ng-container *ngFor="let careSettingConfig of careSettingConfigs">
        <div class="col-12 mb-4">
          <ng-container [ngTemplateOutlet]="settingEmail"
                        [ngTemplateOutletContext]="careSettingConfig">
          </ng-container>
        </div>
      </ng-container>

      <div *ngIf="careSettingConfigs.length > 0"
           class="col col-sm-12 pt-2 text-right">
        <button mat-flat-button
                type="button"
                color="primary"
                (click)="sendProvisionerAccessLinkTo()">
          Send Email
        </button>
      </div>

      <ng-template #settingEmail
                   let-setting="setting"
                   let-settingPlural="settingPlural"
                   let-settingCode="settingCode"
                   let-formArray="formArray"
                   let-formArrayName="formArrayName"
                   let-subheaderContent="subheaderContent">
        <app-page-subheader [divider]="false">
          <ng-container appPageSubheaderTitle>{{ setting }}</ng-container>
          <ng-container appPageSubheaderSummary>
            {{ subheaderContent }}
          </ng-container>
        </app-page-subheader>

        <form [formGroup]="form">
          <div class="row">
            <div class="col col-sm-8"
                 [formArrayName]="formArrayName">
              <ng-container *ngFor="let email of formArray.controls; let i = index;"
                            [formGroupName]="i">
                <app-email-form [form]="email"
                                [index]="i"
                                [validate]="true"
                                [showRemoveButton]="i>0"
                                (remove)="removeEmail(settingCode, $event)">
                </app-email-form>
              </ng-container>
            </div>

            <div class="col col-sm-12">
              <button mat-button
                      type="button"
                      color="primary"
                      (click)="addEmptyEmailInput(settingCode)">
                <mat-icon>add</mat-icon>
                Add email of PharmaNet administrator
              </button>
            </div>
          </div>
        </form>

      </ng-template>

      <ng-template #renewalConfirmation>
        <div imageName="notification"
             class="col-12">
          <ng-container appInfographicHeader>
            Share your approval with your PharmaNet administrator
          </ng-container>
          <ng-container appInfographicDescription>
            When PRIME approved you to access PharmaNet, you were assigned a global PharmaNet ID (GPID).
            <br><br>
            Examples of when you would need to share your GPID:
            <ul>
              <li>If I change work sites</li>
              <li>If I change jobs</li>
              <li>If my worksite has new PharmaNet software</li>
            </ul>
          </ng-container>
          <ng-container appInfographicContent
                        *ngIf="enrolment.currentStatus.statusCode === EnrolmentStatus.EDITABLE">

            <p>
              To share your GPID, enter the email address of your PharmaNet administrator(s) below. A PharmaNet
              administrator is the person in your workplace who sets up PharmaNet access.
            </p>

            <p>
              PRIME will send your enrolment information to your PharmaNet administrator(s) so they can set up your
              access.
            </p>

            <p class="mb-4 font-italic">
              Note: You cannot access PharmaNet without completing this step.
            </p>

          </ng-container>
        </div>
      </ng-template>

    </div>
  </app-enrollee-page>
</div>
