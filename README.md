## DESCRIPTION
PharmaNet Revisions fo Information Management Enhancements (PRIME)

## HOW TO DEPLOY

Clone a copy of the code from this repository, then deploy the code using the 
following Docker command in the optimize-prime folder:

	docker-compose up --build

## HOW TO DEVELOP

To get the project up and running, install Docker and run the following
Docker command:

	docker-compose up --build	

To update the database schema, first update the model file in the
[Models](prime-dotnet-webapi/Models) folder, and rebuild using:

	docker-compose up --build

To generate a new migration file, run this command:

	dotnet ef migrations add InitialCreate

Then, to migrate the new model schema over to the database, run the
following command:

	dotnet ef database update
	
Your changes will be deployed automatically next time the app starts.

## DOCUMENTATION

We have further [Documentation](documentation/Readme.md) available.

## APACHE 2.0 LICENSE

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

## Running the Aries Agent Locally for Verifiable Credential Testing and Development

To run the project you will need to open two terminals:

- one terminal in the [ngrok](./ngrok) folder: run the [start-ngrok.sh](./ngrok/start-ngrok.sh) script, this will initialize an ngrok tunnel that will be used to forward requests to your agent.

- uncomment `agent` and `wallet` servies defined in [docker-compose.yml](./docker/docker-compose.yml). These must be run through the manage script to populate the required environment variables, and CANNOT be started doing docker-compose up --build alone.

- one terminal in the [moh-prime]root folder: run `./manage start`. This will start all of the services defined in [docker-compose.yml](./docker/docker-compose.yml).

Once started the agent services will be listening on localhost as follows:
- `agent`: http://localhost:8024 (admin API).
- `db` and `wallet` postgres databases will respectively be listening on ports `5432` and `5434`.

You can always run `./manage -h` to get more information about the usage of the script, and refer to it to find values for environment variables being set and consumed by `docker-compose`.

**Please Note:** when starting the project, a `.env` file containing the agent wallet seed will be generated in the [docker](./docker) folder. Do not edit this file manually, as its contents are used by the services to persist the agent's information and will be handled automatically by the `manage` script.

## Debugging API Container Using vsdbg
- Start dotnet-webapi(primeapi) container using either `docker-compose up --build` or `./manage start` if using the VC agent
- In VSCode, go to Run and Debug (`Ctrl+Shift+D`), then choose `.Net Core Attach` in dropdown
- Start Debugging, and choose the `prime` process
- Add breakpoints, and debug

